const { ethers } = require("ethers");
const { emasm } = require("emasm");
const { expect } = require("chai");
const { estimateGas } = require("..");

const provider = new ethers.InfuraProvider('mainnet');

describe('estimate-hypothetical-gas', () => {
  it('should correctly avoid revert', async () => {
    const data = emasm([
      '0x1',
      'should-not-reach',
      'jumpi',
      '0x1',
      '0x0',
      'mstore',
      '0x20',
      '0x0',
      'return',
      ['should-not-reach', ['0x0', '0x0', 'revert']]
    ]);
    const wallet = ethers.Wallet.createRandom();
    const from = wallet.address;
    const result = await estimateGas(provider, {
      from,
      data
    });
    console.log(result);
  });
  it('should evaluate a tx script', async () => {
    const result = await estimateGas(provider, {
      data: '0x583d6101843d3d6e22d473030f116ddee9f6b43ac78ba35a7f30f28b7a0000000000000000000000000000000000000000000000000000000060005273c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2600452661ab1802ffcf2296024526364cea6c76044526364cff84760645230608452661ab1802ffcf22960a45273ffdd503549c25ac233a58acdc49f22c5c6e2a31860c45261010060e4526041610104527f7084278241a6742f6b646449b50b58202169fe4919e310b12774683c203e5a88610124527f58eb1f35377473cbf663afa6c322ac070bb52eff7a3f814de3f432fd759a2476610144527f1c0000000000000000000000000000000000000000000000000000000000000061016452f16000600060246000600073c02aaa39b223fe8d0a0e5c4f27ead9083c756cc25a7f2e1a7d4d00000000000000000000000000000000000000000000000000000000600052661ab1802ffcf229600452f1166000600060006000661ab1802ffcf229732314afbb7fff176daec569182aac71737ceabf915af11660006000610184600060006e22d473030f116ddee9f6b43ac78ba35a7f30f28b7a0000000000000000000000000000000000000000000000000000000060005273f819d9cb1c2a819fd991781a822de3ca8607c3c960045267016345785d8a00006024526364cea6ca6044526364cff84a60645273ffdd503549c25ac233a58acdc49f22c5c6e2a31860845267016345785d8a000060a452732314afbb7fff176daec569182aac71737ceabf9160c45261010060e4526041610104527f01129d48a2e15e400d375cbd9168cffe7d2a2d88f2d70a0115c5bda642a8dee7610124527f4d5b885d1a8350246c387d2562fd15b9917a263f6873a6786434ef953025800c610144527f1c0000000000000000000000000000000000000000000000000000000000000061016452f116156102d357732314afbb7fff176daec569182aac71737ceabf91ff5b60006000fd',
      from: "0xb26791fBcBB3617d167dECcEFD786CA1472bb25f",
      gasPrice: '0x00'
    });
    console.log(result);
  });
});
	
