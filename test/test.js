const { ethers } = require("ethers");
const { emasm } = require("emasm");
const { expect } = require("chai");
const { estimateGas } = require("..");

const provider = new ethers.InfuraProvider('mainnet');

describe('estimate-hypothetical-gas', () => {
  it('should correctly avoid revert', async () => {
    const data = emasm([
      '0x1',
      'should-not-reach',
      'jumpi',
      '0x1',
      '0x0',
      'mstore',
      '0x20',
      '0x0',
      'return',
      ['should-not-reach', ['0x0', '0x0', 'revert']]
    ]);
    const wallet = ethers.Wallet.createRandom();
    const from = wallet.address;
    const result = await estimateGas(provider, {
      from,
      data
    });
    console.log(result);
  });
  it('should evaluate a tx script', async () => {
    const result = await estimateGas(provider, {
      data: '0x583d6101843d3d6e22d473030f116ddee9f6b43ac78ba35a7f30f28b7a0000000000000000000000000000000000000000000000000000000060005273c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2600452661ab1802ffcf2296024526364ceeea66044526364d0402660645230608452661ab1802ffcf22960a45273ffdd503549c25ac233a58acdc49f22c5c6e2a31860c45261010060e4526041610104527f42fc79fd114dc0ed2b8ca42ab90fe13ae6682bc32485afd168f3c6431a5b2ea1610124527f38345014c4b0cff0a24884b864a7614eddd480547c3a6709ba11f4e1bfae0665610144527f1c0000000000000000000000000000000000000000000000000000000000000061016452f16000600060246000600073c02aaa39b223fe8d0a0e5c4f27ead9083c756cc25a7f2e1a7d4d00000000000000000000000000000000000000000000000000000000600052661ab1802ffcf229600452f1166000600060006000661ab1802ffcf229732314afbb7fff176daec569182aac71737ceabf915af11660006000610184600060006e22d473030f116ddee9f6b43ac78ba35a7f30f28b7a0000000000000000000000000000000000000000000000000000000060005273f819d9cb1c2a819fd991781a822de3ca8607c3c960045267016345785d8a00006024526364ceeea86044526364d0402860645273ffdd503549c25ac233a58acdc49f22c5c6e2a31860845267016345785d8a000060a452732314afbb7fff176daec569182aac71737ceabf9160c45261010060e4526041610104527feda705817600b02c2eac69f2551a7872a237ed7679be7fc3d9916e0aafedc4e6610124527f270dd2febb54faa578f0e4bc8c9b4ca5f77cf2540ea25003e6c8bf7f8d5d35c8610144527f1b0000000000000000000000000000000000000000000000000000000000000061016452f116156102d357732314afbb7fff176daec569182aac71737ceabf91ff5b60006000fd',
      from: "0x2D463eCb81b22C3b0062B987344B79c0905BFDA1",
      gasPrice: '0x00'
    });
    console.log(result);
  });
});
	
